{"version":3,"sources":["../../../../server/components/cmeasy/cmeasy.flatten.service.js"],"names":[],"mappings":";;AAEA,YAAY,CAAC;;;;;;;;;;sBAGC,QAAQ;;;;oBACL,MAAM;;;;;;;qBAKR,OAAO;;;;;;;AAQtB,SAAS,OAAO,CAAC,MAAM,EAAC;;AAEtB,SAAO,yBAAE,uBAAK,MAAM,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,CACpC,GAAG,CAAC,iBAAiB,CAAC,CACtB,MAAM,EAAE,CACR,GAAG,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC,CACpC,MAAM,EAAE,CACR,MAAM,CAAC,oBAAE,KAAK,CAAC,CAAC;CACpB;;;;;AAKD,SAAS,uBAAuB,CAAC,MAAM,EAAC;AACtC,SAAO,UAAS,IAAI,EAAC;AACnB,QAAI,UAAU,GAAG,oBAAE,KAAK,CAAC,EAAC,IAAI,EAAE,IAAI,EAAC,EAAE,oBAAE,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;AAC5D,QAAG,UAAU,CAAC,IAAI,YAAY,KAAK,EAAC;AAClC,iCAAS,IAAI,EAAG,oBAAE,KAAK,CAAC,UAAU,EAAE,EAAC,IAAI,EAAE,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,EAAC,CAAC,EAAE;KACjF,MACI;AACH,iCAAS,IAAI,EAAG,UAAU,EAAE;KAC7B;GACF,CAAA;CACF;;;;;;AAMD,SAAS,iBAAiB,CAAC,IAAI,EAAE,GAAG,EAAC;;AAEnC,MAAM,SAAS,GAAG,OAAO,CAAC;;AAE1B,MAAG,GAAG,CAAC,OAAO,CAAC,SAAS,CAAC,EAAC;AACxB,WAAO,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;GACjD,MACI;AACH,WAAO,SAAS,CAAC;GAClB;CAEF","file":"cmeasy.flatten.service.js","sourcesContent":["\n\n'use strict';\n\n\nimport _ from 'lodash';\nimport flat from 'flat';\n\n/**\n *\n */\nexport default flatten;\n\n\n/**\n *\n * @param schema\n * @returns {*}\n */\nfunction flatten(schema){\n\n  return _(flat(schema, { maxDepth: 0 }))\n    .map(parseFlattenPaths)\n    .filter()\n    .map(getDefinitionsFromPaths(schema))\n    .filter()\n    .reduce(_.merge);\n}\n\n/**\n *\n */\nfunction getDefinitionsFromPaths(schema){\n  return function(path){\n    var definition = _.merge({path: path}, _.get(schema, path));\n    if(definition.type instanceof Array){\n      return {[path]: _.merge(definition, {type: flatten(definition.type[0] || {})})};\n    }\n    else {\n      return {[path]: definition};\n    }\n  }\n}\n\n/**\n *\n * @param key\n */\nfunction parseFlattenPaths(path, key){\n\n  const typeIndex = '.type';\n\n  if(key.indexOf(typeIndex)){\n    return key.substring(0, key.indexOf(typeIndex));\n  }\n  else {\n    return undefined;\n  }\n\n}\n"]}