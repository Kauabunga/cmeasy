{"version":3,"sources":["../../../../server/components/cmeasy/cmeasy.controller.model.js"],"names":[],"mappings":"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","file":"cmeasy.controller.model.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/generated              ->  index\n * POST    /api/generated              ->  create\n * GET     /api/generated/:id          ->  show\n * PUT     /api/generated/:id          ->  update\n * DELETE  /api/generated/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport Promise from 'bluebird';\nimport uuid from 'uuid';\n\n/**\n *\n * TODO catch and rethrow for ensured logging\n */\nexport default function(model, schemaController){\n\n  return {\n    index: index,\n    indexClean: _.flow(index, cleanObject),\n    create: create,\n    show: show,\n    history: history,\n    destroy: destroy\n  };\n\n\n\n\n  /**\n   * Gets a list of Generateds\n   *\n   */\n  function index() {\n    return getModelSchema()\n      .then(function(schema) {\n        if(isSchemaSingleton(schema)){\n          return showSingleton(model.getId())\n            .then(function(singleton){\n              //convert back into an array to keep consistency\n              return [].concat(singleton);\n            });\n        }\n        else {\n          return model.getModel().find({})\n            .sort(getSortQuery()).execAsync()\n            .then(getUniqueIds(model, schema));\n        }\n      });\n  }\n\n\n  /**\n   * Gets a single Generated from the DB\n   *\n   */\n  function show(id) {\n\n    console.log(`Model:Show:Start:${model.getId()}:${id}`);\n\n    return getModelSchema()\n      .then(function(schema){\n        if(isSchemaSingleton(schema)){\n          return showSingleton(id);\n        }\n        else {\n          return showInstance(id);\n        }\n      })\n      .then(function(item){\n        console.log(`Model:Show:Finish:${model.getId()}:${id}:${item}`);\n        return item;\n      });\n  }\n\n  /**\n   *\n   * @param id\n   * @returns {*}\n   */\n  function showSingleton(id){\n\n    return model.getModel().find(getIdQuery(id, {meta: {singleton: true}})).sort(getSortQuery()).execAsync()\n      .then(function(items){\n        //if this item is a singleton and there isn't one -> go and create it\n        if(! items || items.length === 0 ){\n          return create({});\n        }\n        else {\n          return _(items).first();\n        }\n      });\n  }\n\n  /**\n   *\n   * @param id\n   * @param schema\n   */\n  function showInstance(id){\n    return model.getModel().find(getIdQuery(id, {meta: {singleton: false}})).sort(getSortQuery()).execAsync()\n      .then(function(items){\n        return _(items).first();\n      });\n  }\n\n\n  /**\n   * Creates a new Generated in the DB\n   *\n   */\n  function create(item = {}) {\n\n    console.log(`Model:Create:Start:${model.getId()}:${item[model.getInstanceKey()] || ''}:${item || ''}`);\n\n    return getCreateResolve(item)\n      .then(function([schema, currentItem]){\n        return model.getModel().createAsync(getCreateItem(schema, item, currentItem));\n      })\n      .then(function(createdItem){\n        console.log(`Model:Create:Finish:${model.getId()}:${item[model.getInstanceKey()] || ''}:${createdItem || ''}`);\n        return createdItem;\n      });\n\n  }\n\n  /**\n   *\n   */\n  function getCreateResolve(item){\n\n    return getModelSchema()\n      .then(function(schema){\n\n        //If the model is not a singleton or it contains an instance key\n        //then we need to go fetch the previous instance (if one exists)\n        if( ! isSchemaSingleton(schema) || item[model.getInstanceKey()]){\n          return showInstance(item[model.getInstanceKey()])\n            .then(getModelAsObject)\n            .then(function(currentItem = {}){\n              return [schema, currentItem];\n            });\n        }\n        else {\n          return [schema, {}];\n        }\n\n      });\n\n  }\n\n  /**\n   *\n   * @returns {*}\n   */\n  function getModelSchema(){\n    return schemaController.show(model.getId());\n  }\n\n\n  /**\n   *\n   */\n  function isSchemaSingleton(schema){\n    return schema && schema.meta && schema.meta.singleton;\n  }\n\n  /**\n   *\n   * @returns {Object}\n   */\n  function getCreateItem(schema, item, currentItem = {}){\n    return _.merge(getDefaultItem(schema), getStrippedCurrentItem(currentItem), getValidItem(schema, item));\n  }\n\n  /**\n   *\n   * @param schema\n   * @param item\n   */\n  function getValidItem(schema, item){\n    return _(item).map(getValidItemProperty(schema.definition))\n      .filter()\n      .reduce(_.merge) || {};\n  }\n\n  /**\n   *\n   */\n  function getStrippedCurrentItem(currentItem){\n    return _.omit(currentItem, ['_id', '__v', 'author', 'dateCreated', 'comment']);\n  }\n\n  /**\n   *\n   * @param value\n   * @param key\n   */\n  function getValidItemProperty(schema){\n    return function(value, key){\n\n      //TODO test to make sure schema[key].type === value.prototype or something along those lines\n      return isEditDisabled(schema, key) ? {[key]: undefined } : {[key]: value};\n    }\n  }\n\n  /**\n   *\n   */\n  function isEditDisabled(schema, key){\n    return ['_id', '__v'].indexOf(key) !== -1 || ! schema[key] || schema[key].disableEdit;\n  }\n\n\n  /**\n   *\n   * @param model\n   */\n  function getModelAsObject(model){\n    return model && model.toObject();\n  }\n\n  /**\n   *\n   * @param schema\n   * @returns {*}\n   */\n  function getDefaultItem(schema){\n    return _(schema.definition).map(getSchemaPropertyDefault)\n      .filter()\n      .reduce(_.merge) || {};\n  }\n\n  /**\n   * TODO how to set a default as a function -> need to check cmeasy model\n   */\n  function getSchemaPropertyDefault(schema, key){\n\n    if(key === '_cmeasyInstanceId'){\n      return { [key]: uuid.v4() };\n    }\n    else if(key === 'dateCreated'){\n      return { [key]: Date.now() };\n    }\n    else {\n      return { [key]: schema && typeof schema.default === 'function' ? schema.default() : schema.default };\n    }\n\n  }\n\n  /**\n   * Gets the history of an item\n   *\n   */\n  function history(id) {\n    return getModelSchema()\n      .then(function(schema) {\n        return model.getModel().find(getIdQuery(id, schema)).sort(getSortQuery()).execAsync();\n      });\n  }\n\n\n  /**\n   * Deletes a Generated from the DB\n   *\n   */\n  function destroy(id) {\n    return getModelSchema()\n      .then(function(schema){\n        return model.getModel().find(getIdQuery(id, schema)).execAsync().then(destroyAll);\n      });\n\n\n  }\n\n\n  /**\n   *\n   */\n  function getIdQuery(id, schema){\n    if(isSchemaSingleton(schema)){\n      return { [model.getIdKey()]: id };\n    }\n    else {\n      return { [model.getInstanceKey()]: id };\n    }\n  }\n\n  /**\n   *\n   */\n  function getSortQuery(){\n    return { 'dateCreated': -1 };\n  }\n\n  /**\n   *\n   * @param item\n   * @returns {*}\n   */\n  function destroyAll(items){\n    return Promise.all(_(items).map((item) => {return item.removeAsync();}).value());\n  }\n\n\n\n  /**\n   *\n   */\n  function getUniqueIds(model, schema){\n    return function (entity) {\n\n      if(isSchemaSingleton(schema)){\n        return _(entity)\n          .map((item)=>{ return item.toObject(); })\n          .uniq(model.getIdKey())\n          .value();\n      }\n      else {\n        return _(entity)\n          .map((item)=>{ return item.toObject(); })\n          .uniq(model.getInstanceKey())\n          .value();\n      }\n    };\n  }\n\n\n  /**\n   *\n   *\n   * @param item\n   * @returns {*}\n   */\n  function cleanObject(item) {\n    if(typeof item.then === 'function'){\n      return item.then(_cleanObject);\n    }\n    else {\n      return _cleanObject(item);\n    }\n  }\n\n  /**\n   *\n   * @param item\n   * @returns {*}\n   * @private\n   */\n  function _cleanObject(item){\n\n    if (item instanceof Array) {\n      return _(item).map(function (singleItem) {\n        if(typeof singleItem.toObject === 'function'){\n          return _.omit(singleItem.toObject(), getCleanProperties());\n        }\n        else {\n          return _.omit(singleItem, getCleanProperties());\n        }\n      }).value();\n    }\n    else {\n      if(typeof item.toObject === 'function'){\n        return _.omit(item.toObject(), getCleanProperties());\n      }\n      else {\n        return _.omit(item, getCleanProperties());\n      }\n\n    }\n  }\n\n  /**\n   *\n   * @returns {string[]}\n   */\n  function getCleanProperties(){\n    return ['_id', '__v', 'author', 'comment', 'dateCreated'];\n  }\n\n\n\n}\n"]}